/* AAP 2022 (SUPPLEMENTAL TABLE 2) - Phototherapy thresholds (mg/dL)
   Any hyperbilirubinemia neurotoxicity risk factor, by GA and age (hours).
   Populate the arrays below using the built-in converter in the app (Verify panel).
   This file ships with empty datasets to avoid showing incorrect values by default. */
(function(global){
  function toHourly(days){
    const out = [];
    for(let d=0; d<days.length; d++){
      const row = days[d] || [];
      for(let h=0; h<row.length; h++) out.push({ x: d*24 + h, y: row[h] });
    }
    return out;
  }

  // Replace the [] arguments with your 15×24 arrays, e.g., toHourly([[...24...], ... 15 rows ...])
  const GA_38P = toHourly([[0,6.4,6.6,6.8,7,7.2,7.3,7.5,7.7,7.9,8.1,8.3,8.5,8.6,8.8,9,9.2,9.4,9.5,9.7,9.9,10,10.2,10.4],
    [10.5,10.7,10.8,11,11.2,11.3,11.5,11.6,11.8,11.9,12.1,12.2,12.4,12.5,12.7,12.8,12.9,13.1,13.2,13.3,13.5,13.6,13.7,13.9],
    [14,14.1,14.2,14.4,14.5,14.6,14.7,14.8,14.9,15.1,15.2,15.3,15.4,15.5,15.6,15.7,15.8,15.9,16,16.1,16.2,16.3,16.4,16.5],
    [16.6,16.6,16.7,16.8,16.9,17,17.1,17.1,17.2,17.3,17.4,17.4,17.5,17.6,17.6,17.7,17.8,17.8,17.9,18,18,18.1,18.1,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2]]); // Gestational age ≥38 weeks (use also for 39 and 40 unless you create distinct arrays)
  const GA_37  = toHourly([[0,5.9,6.1,6.3,6.5,6.7,6.9,7,7.2,7.4,7.6,7.8,8,8.1,8.3,8.5,8.7,8.9,9,9.2,9.4,9.5,9.7,9.9],
    [10,10.2,10.4,10.5,10.7,10.8,11,11.1,11.3,11.4,11.6,11.7,11.9,12,12.2,12.3,12.4,12.6,12.7,12.9,13,13.1,13.2,13.4],
    [13.5,13.6,13.8,13.9,14,14.1,14.2,14.4,14.5,14.6,14.7,14.8,14.9,15,15.1,15.2,15.3,15.4,15.5,15.6,15.7,15.8,15.9,16],
    [16.1,16.2,16.3,16.4,16.5,16.6,16.6,16.7,16.8,16.9,17,17,17.1,17.2,17.2,17.3,17.4,17.4,17.5,17.6,17.6,17.7,17.8,17.8],
    [17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,18,18,18,18,18,18,18,18],
    [18,18,18,18,18,18,18,18,18,18,18,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1],
    [18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2]]);
  const GA_36  = toHourly([[0,5.4,5.6,5.8,6,6.2,6.3,6.5,6.7,6.9,7.1,7.3,7.4,7.6,7.8,8,8.1,8.3,8.5,8.6,8.8,9,9.1,9.3],
    [9.4,9.6,9.8,9.9,10.1,10.2,10.4,10.5,10.7,10.8,11,11.1,11.2,11.4,11.5,11.7,11.8,11.9,12.1,12.2,12.3,12.5,12.6,12.7],
    [12.8,13,13.1,13.2,13.3,13.4,13.5,13.7,13.8,13.9,14,14.1,14.2,14.3,14.4,14.5,14.6,14.7,14.8,14.9,15,15.1,15.2,15.3],
    [15.4,15.4,15.5,15.6,15.7,15.8,15.8,15.9,16,16.1,16.1,16.2,16.3,16.4,16.4,16.5,16.6,16.6,16.7,16.7,16.8,16.8,16.9,17],
    [17,17,17,17,17,17,17,17,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1],
    [17.1,17.1,17.1,17.1,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.3],
    [17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.4,17.4,17.4,17.4,17.4],
    [17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5],
    [17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.5,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6,17.6],
    [17.6,17.6,17.6,17.6,17.6,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7,17.7],
    [17.7,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.8,17.9,17.9,17.9,17.9],
    [17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,17.9,18,18,18,18,18,18,18,18],
    [18,18,18,18,18,18,18,18,18,18,18,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.1],
    [18.1,18.1,18.1,18.1,18.1,18.1,18.1,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2],
    [18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2,18.2]]);
  const GA_35  = toHourly([[0,4.9,5.1,5.3,5.5,5.6,5.8,6,6.2,6.4,6.5,6.7,6.9,7.1,7.2,7.4,7.6,7.7,7.9,8.1,8.2,8.4,8.6,8.7],
    [8.9,9,9.2,9.3,9.5,9.6,9.8,9.9,10.1,10.2,10.3,10.5,10.6,10.8,10.9,11,11.2,11.3,11.4,11.5,11.7,11.8,11.9,12],
    [12.2,12.3,12.4,12.5,12.6,12.7,12.8,13,13.1,13.2,13.3,13.4,13.5,13.6,13.7,13.8,13.9,14,14.1,14.2,14.2,14.3,14.4,14.5],
    [14.6,14.7,14.8,14.8,14.9,15,15.1,15.1,15.2,15.3,15.3,15.4,15.5,15.5,15.6,15.7,15.7,15.8,15.8,15.9,15.9,16,16.1,16.1],
    [16.1,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.2,16.3,16.3,16.3,16.3],
    [16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.3,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4],
    [16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.4,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5,16.5],
    [16.5,16.5,16.5,16.5,16.5,16.5,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6,16.6],
    [16.6,16.6,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.7,16.8,16.8,16.8],
    [16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.8,16.9,16.9,16.9,16.9,16.9,16.9,16.9],
    [16.9,16.9,16.9,16.9,16.9,16.9,16.9,16.9,16.9,16.9,16.9,16.9,17,17,17,17,17,17,17,17,17,17,17,17],
    [17,17,17,17,17,17,17,17,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1,17.1],
    [17.1,17.1,17.1,17.1,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.2,17.3],
    [17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.3,17.4,17.4,17.4,17.4,17.4],
    [17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4,17.4]]);

  const tables = { 35: GA_35, 36: GA_36, 37: GA_37, 38: GA_38P, 39: GA_38P, 40: GA_38P };

  function getPhotoAt(ga, hours){
    const arr = tables[ga] || tables[38] || [];
    if(!arr.length) return null;
    if(hours <= 0) return arr[0].y;
    if(hours >= arr[arr.length-1].x) return arr[arr.length-1].y;
    for(let i=1;i<arr.length;i++){
      const p0 = arr[i-1], p1 = arr[i];
      if(hours <= p1.x){
        const t = (hours - p0.x) / (p1.x - p0.x);
        return p0.y + t*(p1.y - p0.y);
      }
    }
    return arr[arr.length-1].y;
  }

  // Exact completed hour (floor)
  function getPhotoExact(ga, hours){
    const arr = tables[ga] || tables[38] || [];
    if(!arr.length) return { hour: Math.max(0, Math.floor(hours||0)), value: null };
    const age = Math.max(0, hours||0);
    let h = Math.floor(age);
    h = Math.max(0, Math.min(arr.length - 1, h));
    const p = arr[h];
    return { hour: p.x, value: p.y };
  }

  global.AAP_AnyRisk_Phototherapy = { tables, getPhotoAt, getPhotoExact };
})(window);
